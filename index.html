<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPM Vinyl AI</title>
</head>
<body style="font-family:sans-serif;text-align:center;">

  <h1>CPM ãƒã‚¤ãƒŠãƒ«AIé…ç½®ãƒ„ãƒ¼ãƒ«</h1>

  <p>â‘  è»Šã®ç”»åƒã‚’é¸æŠ</p>
  <input type="file" id="car" accept="image/*"><br><br>

  <p>â‘¡ ãƒã‚¤ãƒŠãƒ«ç”»åƒã‚’é¸æŠ</p>
  <input type="file" id="vinyl" accept="image/*"><br><br>

  <button id="btn" style="font-size:18px;padding:10px 20px;">
    AIã§è§£æã™ã‚‹
  </button>

  <script>
    const car = document.getElementById("car");
    const vinyl = document.getElementById("vinyl");
    const btn = document.getElementById("btn");

    btn.onclick = async () => {
      if (!car.files[0] || !vinyl.files[0]) {
        alert("è»Šç”»åƒã¨ãƒã‚¤ãƒŠãƒ«ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
      }

      const formData = new FormData();
      formData.append("car", car.files[0]);
      formData.append("vinyl", vinyl.files[0]);

      document.body.innerHTML = `
        <h1>ğŸ¤– AIè§£æä¸­â€¦</h1>
        <p>ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¦ã„ã¾ã™</p>
      `;

      try {
        const res = await fetch(
          "https://cpm-vinyl-ai--ikkisaito0226.replit.app/analyze",
          {
            method: "POST",
            body: formData
          }
        );

        const data = await res.json();
        const pos = data.recommended[0];

        showResult(pos.top, pos.left);

      } catch (e) {
        document.body.innerHTML = `
          <h2>âŒ AIã‚µãƒ¼ãƒæ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ</h2>
          <button onclick="location.reload()">æˆ»ã‚‹</button>
        `;
      }
    };

    function showResult(top, left) {
      const carURL = URL.createObjectURL(car.files[0]);
      const vinylURL = URL.createObjectURL(vinyl.files[0]);

      document.body.innerHTML = `
        <h1>AIé…ç½®çµæœ</h1>

        <div style="
          position:relative;
          width:90%;
          max-width:360px;
          margin:auto;
        ">
          <img src="${carURL}" style="width:100%;">
          <img src="${vinylURL}" style="
            position:absolute;
            top:${top * 100}%;
            left:${left * 100}%;
            width:40%;
            opacity:0.85;
          ">
        </div>

        <p>AIãŒè‡ªå‹•ã§é…ç½®ã‚’æ¨å®šã—ã¾ã—ãŸ</p>

        <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦</button>
      `;
    }
  </script>

</body>
</html>
