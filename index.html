<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CPM Vinyl Auto</title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin: 0;
  padding: 20px;
  background: #f7f7f7;
}
h1 { margin-top: 10px; }
.box {
  background: #fff;
  padding: 10px;
  margin: 15px auto;
  width: 90%;
  max-width: 400px;
  border-radius: 10px;
}
button {
  padding: 10px 20px;
  font-size: 16px;
}
#vinylChan {
  position: fixed;
  right: 10px;
  bottom: 10px;
  text-align: center;
  font-size: 12px;
}
#vinylChan img {
  width: 80px;
  border-radius: 10px;
}
canvas {
  width: 90%;
  max-width: 360px;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>CPM Vinyl Auto</h1>
<p>
Car Parking Multiplayer å°‚ç”¨<br>
AIãƒã‚¤ãƒŠãƒ«é…ç½® ææ¡ˆãƒ„ãƒ¼ãƒ«
</p>

<div class="box">
  <p>â‘  è»Šã®ç”»åƒ</p>
  <input type="file" id="car" accept="image/*">
</div>

<div class="box">
  <p>â‘¡ ãƒã‚¤ãƒŠãƒ«ç”»åƒï¼ˆPNGæ¨å¥¨ï¼‰</p>
  <input type="file" id="vinyl" accept="image/*">
</div>

<button id="start" disabled>AIè§£æé–‹å§‹</button>

<p style="font-size:12px; opacity:0.8;">
â€» CPMã¯çª“ã«ã‚‚ãƒã‚¤ãƒŠãƒ«ãŒè²¼ã‚Œã¾ã™ï¼ˆæœ¬ãƒ„ãƒ¼ãƒ«ã¯çª“ãƒ»ãƒœãƒ‡ã‚£å¯¾å¿œï¼‰
</p>

<!-- Vinylã¡ã‚ƒã‚“ -->
<div id="vinylChan">
  <img src="https://via.placeholder.com/120x180?text=Vinyl-chan">
  <p>Vinylã¡ã‚ƒã‚“</p>
</div>

<script>
const car = document.getElementById("car");
const vinyl = document.getElementById("vinyl");
const btn = document.getElementById("start");

function check() {
  btn.disabled = !(car.files.length && vinyl.files.length);
}
car.onchange = check;
vinyl.onchange = check;

btn.onclick = async () => {
  const formData = new FormData();
  formData.append("car", car.files[0]);
  formData.append("vinyl", vinyl.files[0]);

  document.body.innerHTML = `
    <h1>AIè§£æä¸­â€¦</h1>
    <p>ã‚µãƒ¼ãƒãƒ¼ã§ç”»åƒã‚’åˆ†æã—ã¦ã„ã¾ã™</p>
    <div style="font-size:40px;">ğŸ¤–</div>
    <div id="vinylChan">
      <img src="https://via.placeholder.com/120x180?text=Vinyl-chan">
      <p>Vinylã¡ã‚ƒã‚“</p>
    </div>
  `;

  try {
    const res = await fetch("https://cpm-vinyl-ai--ikkisaito0226.replit.app/analyze", {

      { method: "POST", body: formData }
    );

    const data = await res.json();
    const pos = data.recommended[0];

    showAIResult(pos.top, pos.left);

  } catch (e) {
    document.body.innerHTML = "âŒ AIã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ";
  }
};

function showAIResult(top, left) {
  const carURL = URL.createObjectURL(car.files[0]);
  const vinylURL = URL.createObjectURL(vinyl.files[0]);

  document.body.innerHTML = `
    <h1>AIé…ç½®çµæœ</h1>

    <div style="position:relative;width:90%;max-width:360px;margin:auto;">
      <img src="${carURL}" style="width:100%;">
      <img src="${vinylURL}" style="
        position:absolute;
        top:${top * 100}%;
        left:${left * 100}%;
        width:40%;
        opacity:0.85;
      ">
    </div>

    <p>AIãŒè»Šä½“å½¢çŠ¶ã‚’è§£æã—ã¦é…ç½®ã—ã¾ã—ãŸ</p>

    <button onclick="location.reload()">â† æœ€åˆã«æˆ»ã‚‹</button>

    <div id="vinylChan">
      <img src="https://via.placeholder.com/120x180?text=Vinyl-chan">
      <p>Vinylã¡ã‚ƒã‚“</p>
    </div>
  `;
}
</script>

</body>
</html>
