<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CPM Vinyl Auto</title>

<style>
body {
  font-family: sans-serif;
  text-align: center;
  margin: 0;
  padding: 20px;
  background: #f7f7f7;
}
h1 { margin-top: 10px; }
.box {
  background: #fff;
  padding: 10px;
  margin: 15px auto;
  width: 90%;
  max-width: 400px;
  border-radius: 10px;
}
button {
  padding: 10px 20px;
  font-size: 16px;
}
#vinylChan {
  position: fixed;
  right: 10px;
  bottom: 10px;
  text-align: center;
  font-size: 12px;
}
#vinylChan img {
  width: 80px;
  border-radius: 10px;
}
canvas {
  width: 90%;
  max-width: 360px;
  margin-top: 10px;
}
</style>
</head>

<body>

<h1>CPM Vinyl Auto</h1>
<p>
Car Parking Multiplayer å°‚ç”¨<br>
ãƒã‚¤ãƒŠãƒ«é…ç½® è‡ªå‹•ææ¡ˆãƒ„ãƒ¼ãƒ«
</p>

<div class="box">
  <p>â‘  è»Šã®ç”»åƒ</p>
  <input type="file" id="car" accept="image/*">
</div>

<div class="box">
  <p>â‘¡ ãƒã‚¤ãƒŠãƒ«ç”»åƒï¼ˆPNGæ¨å¥¨ï¼‰</p>
  <input type="file" id="vinyl" accept="image/*">
</div>

<button id="start" disabled>è§£æé–‹å§‹</button>

<p style="font-size:12px; opacity:0.8;">
â€» CPMã¯çª“ã«ã‚‚ãƒã‚¤ãƒŠãƒ«ãŒè²¼ã‚Œã¾ã™ï¼ˆæœ¬ãƒ„ãƒ¼ãƒ«ã¯çª“ãƒ»ãƒœãƒ‡ã‚£å¯¾å¿œï¼‰
</p>

<!-- Vinylã¡ã‚ƒã‚“ -->
<div id="vinylChan">
  <img src="https://via.placeholder.com/120x180?text=Vinyl-chan">
  <p>Vinylã¡ã‚ƒã‚“</p>
</div>

<script>
const car = document.getElementById("car");
const vinyl = document.getElementById("vinyl");
const btn = document.getElementById("start");

function check() {
  btn.disabled = !(car.files.length && vinyl.files.length);
}
car.onchange = check;
vinyl.onchange = check;

btn.onclick = () => {
  document.body.innerHTML = `
    <h1>é…ç½®ã‚’é¸æŠ</h1>

    <button onclick="makeImage(0.35,0.30)">â‘  ãƒ‰ã‚¢ä¸­å¤®ï¼ˆç‹é“ï¼‰</button><br><br>
    <button onclick="makeImage(0.30,0.15)">â‘¡ ãƒ•ãƒ­ãƒ³ãƒˆå¯„ã‚Š</button><br><br>
    <button onclick="makeImage(0.40,0.45)">â‘¢ ãƒªã‚¢å¯„ã‚Š</button><br><br>

    <img id="carImg" style="display:none">
    <img id="vinylImg" style="display:none">
    <canvas id="canvas"></canvas>

    <p id="msg"></p>
    <button onclick="location.reload()">â† æœ€åˆã«æˆ»ã‚‹</button>

    <div id="vinylChan">
      <img src="https://via.placeholder.com/120x180?text=Vinyl-chan">
      <p>Vinylã¡ã‚ƒã‚“</p>
    </div>
  `;

  document.getElementById("carImg").src =
    URL.createObjectURL(car.files[0]);
  document.getElementById("vinylImg").src =
    URL.createObjectURL(vinyl.files[0]);
};

function makeImage(top, left) {
  const carImg = document.getElementById("carImg");
  const vinylImg = document.getElementById("vinylImg");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  const wait = setInterval(() => {
    if (carImg.complete && vinylImg.complete) {
      clearInterval(wait);

      canvas.width = carImg.naturalWidth;
      canvas.height = carImg.naturalHeight;

      ctx.drawImage(carImg, 0, 0);

      const x = canvas.width * left;
      const y = canvas.height * top;
      const w = canvas.width * 0.4;

      ctx.globalAlpha = 0.85;
      ctx.drawImage(
        vinylImg,
        x,
        y,
        w,
        w * vinylImg.naturalHeight / vinylImg.naturalWidth
      );

      document.getElementById("msg").innerHTML =
        "ğŸ‘‡ å®Œæˆã—ã¾ã—ãŸã€‚ç”»åƒã‚’é•·æŠ¼ã—ã§ä¿å­˜ã§ãã¾ã™";
    }
  }, 100);
}
</script>

</body>
</html>
