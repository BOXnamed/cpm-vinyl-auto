<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CPM Vinyl AI</title>
<style>
body{font-family:sans-serif;text-align:center;margin:0;padding:20px;background:#f7f7f7;}
h1{margin-top:10px;}
.box{background:#fff;padding:10px;margin:15px auto;width:90%;max-width:400px;border-radius:10px;}
button{padding:10px 20px;font-size:16px;margin:10px;}
canvas{width:90%;max-width:360px;margin-top:10px;}
img{max-width:100%;border-radius:5px;}
</style>
</head>
<body>

<h1>CPM ãƒã‚¤ãƒŠãƒ«AIé…ç½®ãƒ„ãƒ¼ãƒ«ï¼ˆãƒ€ãƒŸãƒ¼AIï¼‰</h1>

<div class="box">
<p>â‘  è»Šç”»åƒ</p>
<input type="file" id="car" accept="image/*">
</div>

<div class="box">
<p>â‘¡ ãƒã‚¤ãƒŠãƒ«ç”»åƒ</p>
<input type="file" id="vinyl" accept="image/*">
</div>

<button id="start" disabled>AIè§£æé–‹å§‹</button>

<script>
const car=document.getElementById("car");
const vinyl=document.getElementById("vinyl");
const btn=document.getElementById("start");

function check(){btn.disabled=!(car.files.length && vinyl.files.length);}
car.onchange=check;
vinyl.onchange=check;

btn.onclick=async()=>{
  const formData=new FormData();
  formData.append("car",car.files[0]);
  formData.append("vinyl",vinyl.files[0]);

  document.body.innerHTML="<h1>ğŸ¤– AIè§£æä¸­â€¦</h1><p>ã‚µãƒ¼ãƒãƒ¼ã§åˆ†æä¸­</p>";

  try{
    const res=await fetch("https://cpm-vinyl-ai--ikkisaito0226.replit.app/analyze",{method:"POST",body:formData});
    const data=await res.json();
    const first=data.recommended[0];
    showResult(first.top,first.left);
  }catch(e){
    document.body.innerHTML='<h2>âŒ AIã‚µãƒ¼ãƒæ¥ç¶šã§ãã¾ã›ã‚“ã§ã—ãŸ</h2><button onclick="location.reload()">æˆ»ã‚‹</button>';
  }
}

function showResult(top,left){
  const carURL=URL.createObjectURL(car.files[0]);
  const vinylURL=URL.createObjectURL(vinyl.files[0]);
  document.body.innerHTML=`
  <h1>AIé…ç½®çµæœ</h1>
  <div style="position:relative;width:90%;max-width:360px;margin:auto;">
    <img src="${carURL}">
    <img src="${vinylURL}" style="position:absolute;top:${top*100}%;left:${left*100}%;width:40%;opacity:0.85;">
  </div>
  <p>AIãŒè‡ªå‹•ã§ãƒã‚¤ãƒŠãƒ«ä½ç½®ã‚’æ¨å®šã—ã¾ã—ãŸ</p>
  <button onclick="location.reload()">ã‚‚ã†ä¸€åº¦</button>
  `;
}
</script>

</body>
</html>
